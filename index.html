<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SwipeShare P2P - @ya_rositt</title>
    <style>
        body { margin: 0; background: #1a1a1a; color: white; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
        
        /* Tampilan Foto */
        #photo { 
            width: 280px; height: 400px; 
            background: #333; border: 4px solid #fff; 
            border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            display: none; position: relative; cursor: grab;
            background-size: cover; background-position: center;
            touch-action: none;
        }

        /* Panel Setup */
        #setup { background: #2c3e50; padding: 20px; border-radius: 15px; text-align: center; width: 80%; max-width: 300px; }
        input[type="text"] { width: 90%; padding: 10px; margin: 10px 0; border-radius: 8px; border: none; }
        button { background: #27ae60; color: white; border: none; padding: 12px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; }
        
        /* Status */
        #status { margin-top: 15px; font-size: 0.9em; color: #ecf0f1; }
        .id-badge { background: #e67e22; padding: 2px 8px; border-radius: 4px; font-family: monospace; }
        
        #fileBtn { margin-top: 20px; background: #2980b9; }
    </style>
</head>
<body>

    <div id="setup">
        <h3>Swipe Share</h3>
        <p>ID Kamu: <span id="my-id" class="id-badge">...</span></p>
        <input type="text" id="target-id" placeholder="Masukkan ID HP Teman">
        <button onclick="connectToPeer()">HUBUNGKAN</button>
        <p id="status">Menunggu ID...</p>
    </div>

    <div id="photo"></div>
    <input type="file" id="fileInput" accept="image/*" style="display: none;">
    <button id="fileBtn" style="display: none;" onclick="document.getElementById('fileInput').click()">PILIH FOTO</button>

    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script>
        const peer = new Peer();
        let conn;
        const photo = document.getElementById('photo');
        const statusText = document.getElementById('status');
        const fileInput = document.getElementById('fileInput');

        // 1. Dapatkan ID Sendiri
        peer.on('open', id => {
            document.getElementById('my-id').innerText = id;
            statusText.innerText = "Siap menghubungkan...";
        });

        // 2. Fungsi Hubungkan (Pihak Pengirim)
        function connectToPeer() {
            const targetId = document.getElementById('target-id').value;
            if(!targetId) return alert("Masukkan ID dulu!");
            conn = peer.connect(targetId);
            setupConnection();
        }

        // 3. Terima Koneksi (Pihak Penerima)
        peer.on('connection', (c) => {
            conn = c;
            setupConnection();
        });

        function setupConnection() {
            conn.on('open', () => {
                document.getElementById('setup').style.display = 'none';
                document.getElementById('fileBtn').style.display = 'block';
                photo.style.display = 'block';
                statusText.innerText = "Terhubung! Pilih foto lalu geser ke kanan.";
            });

            // Mendengarkan Data Masuk
            conn.on('data', (payload) => {
                if(payload.type === 'gambar') {
                    photo.style.backgroundImage = `url(${payload.data})`;
                    photo.style.transition = "none";
                    photo.style.transform = "translateX(-150%) rotate(-10deg)";
                    photo.style.opacity = "1";
                    
                    setTimeout(() => {
                        photo.style.transition = "transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275)";
                        photo.style.transform = "translateX(0) rotate(0deg)";
                    }, 50);
                }
            });
        }

        // 4. Pilih Foto dari Galeri
        fileInput.onchange = (e) => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = (event) => {
                photo.style.backgroundImage = `url(${event.target.result})`;
            };
            reader.readAsDataURL(file);
        };

        // 5. Logika Geser (Swipe)
        let startX;
        photo.addEventListener('touchstart', e => {
            startX = e.touches[0].clientX;
            photo.style.transition = "none";
        });

        photo.addEventListener('touchmove', e => {
            let moveX = e.touches[0].clientX - startX;
            if (moveX > 0) {
                photo.style.transform = `translateX(${moveX}px) rotate(${moveX/15}deg)`;
            }
            
            if (moveX > 180) { // Threshold kirim
                photo.style.opacity = "0";
                const bg = photo.style.backgroundImage;
                const base64Data = bg.slice(5, -2); // Ambil string base64 saja
                if(conn) conn.send({ type: 'gambar', data: base64Data });
            }
        });

        photo.addEventListener('touchend', () => {
            if (photo.style.opacity !== "0") {
                photo.style.transition = "transform 0.3s";
                photo.style.transform = "translateX(0) rotate(0deg)";
            }
        });
    </script>
</body>
    </html>
